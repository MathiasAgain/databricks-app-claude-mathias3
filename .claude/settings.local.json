{
  "permissions": {
    "allow": [
      "Bash(git rev-parse:*)",
      "Bash(git remote:*)",
      "Bash(./app_status.sh:*)",
      "Bash(./open_setup.sh)",
      "Bash(test:*)",
      "Bash(./setup.sh)",
      "Bash(databricks auth:*)",
      "Bash(databricks current-user:*)",
      "Bash(cat:*)",
      "Bash(uv sync:*)",
      "Bash(bun install:*)",
      "Bash(kill:*)",
      "Bash(source:*)",
      "Bash(export DATABRICKS_HOST:*)",
      "Bash(export DATABRICKS_CONFIG_PROFILE)",
      "Bash(databricks apps list:*)",
      "Bash(set -a)",
      "Bash(set:*)",
      "Bash(echo:*)",
      "Bash(databricks workspace list:*)",
      "Bash(uv add:*)",
      "Bash(bun add:*)",
      "Bash(curl:*)",
      "Bash(python -m json.tool:*)",
      "Bash(npx shadcn@latest add:*)",
      "Bash(npx playwright install:*)",
      "Bash(node test-app.js:*)",
      "Bash(uv run python:*)",
      "Bash(taskkill:*)",
      "Bash(nul)",
      "Bash(start http://localhost:5174)",
      "Bash(pkill:*)",
      "Bash(start http://localhost:5173)",
      "Bash(npx claude-code-templates@latest:*)",
      "Bash(npx tsc:*)",
      "Bash(bun run tsc:*)",
      "Bash(./deploy.sh)",
      "Bash(uv cache clean:*)",
      "Bash(bun run build:*)",
      "Bash(export DATABRICKS_TOKEN)",
      "Bash(databricks apps deploy:*)",
      "Bash(databricks apps update:*)",
      "Bash(databricks workspace mkdirs:*)",
      "Bash(databricks sync:*)",
      "Bash(python dba_logz.py:*)",
      "Bash(databricks apps get:*)",
      "Bash(python scripts/generate_semver_requirements.py:*)",
      "Bash(python:*)",
      "Bash(databricks workspace-conf:*)",
      "Bash(databricks warehouses get:*)",
      "Bash(if [ -f /tmp/databricks-app-watch.pid ])",
      "Bash(then cat /tmp/databricks-app-watch.pid)",
      "Bash(else echo \"No PID file found\")",
      "Bash(fi)",
      "Bash(bun run generate-client:*)",
      "Bash(databricks apps delete:*)",
      "Bash(databricks apps create:*)",
      "Bash(databricks workspace delete:*)",
      "Bash(databricks workspace import:*)",
      "Bash(databricks service-principals:*)",
      "Bash(/tmp/sps.json)",
      "Bash(bash:*)",
      "Bash(databricks workspace get-status:*)",
      "Bash(git checkout:*)",
      "Bash(git add:*)",
      "Bash(git commit -m \"$(cat <<''EOF''\nCHECKPOINT: Working state - all features functional\n\nâœ… Core Features Working:\n- Genie natural language queries\n- Conversational follow-ups with Claude\n- Dashboard integration\n- AI-generated insights\n- Permissions properly configured\n\nðŸ”§ Key Fixes Applied:\n- Service principal catalog/schema permissions granted\n- Follow-up questions use Claude chat API\n- Conversation history tracking implemented\n- Chat hook added to useGenie\n\nðŸ“Š Permissions Granted:\n- USE CATALOG on p_coe_gold\n- USE SCHEMA on p_coe_gold.ofs_nielsen  \n- SELECT on all tables in schema\n- Warehouse: 939811bf15d2854c\n- Genie Space: 01f0a834208e13dab88b1fd3f7d718c0\n\nðŸš€ Deployed: https://mathias-pse-test-4295693306818923.3.azure.databricksapps.com\n\nThis commit represents a stable, working state before security/quality reviews.\nEOF\n)\")",
      "Skill(code-reviewer)",
      "Bash(npm audit:*)",
      "Bash(git commit -m \"$(cat <<''EOF''\nSecurity and Quality Improvements - Critical Issues Resolved\n\nImplemented comprehensive security and quality fixes based on code audit:\n\n## Security Enhancements:\n\n1. **Environment Validation** (server/config.py)\n   - Added field validators for all required environment variables\n   - Validates Databricks host URL format (must be https://)\n   - Validates all required IDs are non-empty\n   - Validates numeric settings are positive\n   - Provides clear error messages with required variable list\n   - Application exits gracefully with helpful error on misconfiguration\n\n2. **Authentication**\n   - Databricks Apps platform provides built-in authentication via service principal\n   - All API requests are authenticated through the platform layer\n\n## Code Quality Improvements:\n\n3. **Thread-Safe Caching** (server/services/genie_service.py)\n   - Added asyncio.Lock to protect TTLCache operations\n   - Prevents race conditions on concurrent identical queries\n   - Cache reads and writes now properly synchronized\n   - Eliminates risk of duplicate query execution\n\n4. **Timeout Protection** (server/services/claude_service.py)\n   - Added 30-second timeout for Claude analysis operations\n   - Added 20-second timeout for Claude chat operations\n   - Uses asyncio.wait_for for proper async timeout handling\n   - Graceful fallback responses on timeout\n   - Used asyncio.to_thread for blocking SDK calls in async context\n\n## Technical Details:\n\nFiles Modified:\n- server/config.py: Environment validation and startup checks\n- server/services/genie_service.py: Thread-safe cache implementation\n- server/services/claude_service.py: Timeout protection for all Claude API calls\n\nTesting:\n- All Python imports validated successfully\n- Deployment completed with status: SUCCEEDED\n- Uvicorn startup verified in logs\n- No exceptions or errors during initialization\n- API endpoints responding correctly (HTTP 302 redirect for auth)\n\nDeployment:\n- Deployment ID: 01f0baec5bbb13f795e93ba6835e7760\n- App URL: https://mathias-pse-test-4295693306818923.3.azure.databricksapps.com\n- All features remain functional\n\nThese changes address the highest priority issues identified in the security\nand code quality audits while maintaining full backward compatibility.\nEOF\n)\")",
      "Bash(git push:*)",
      "Bash(git commit:*)",
      "Skill(senior-frontend)",
      "Bash(find:*)",
      "Bash(timeout /t 2)",
      "Bash(start /B cmd /C \"nohup ./watch.sh > /tmp/databricks-app-watch.log 2>&1\")",
      "Bash(netstat:*)",
      "Bash(findstr:*)",
      "Bash(timeout /t 2 /nobreak)",
      "Bash(tasklist:*)",
      "Bash(powershell -Command:*)",
      "Bash(./fix.sh)",
      "Bash(bun run prettier:*)",
      "Bash(git rm:*)",
      "Bash(databricks workspace export:*)"
    ],
    "deny": [],
    "ask": []
  }
}
